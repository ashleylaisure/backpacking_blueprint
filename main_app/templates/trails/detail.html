{% extends "base.html" %} {% load static %}
{% block head %}
<link rel="stylesheet" href="{% static "css/trails/trail-detail.css" %}">

    <script src='https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css' rel='stylesheet' />
{% endblock head %}

{% block content %}
<section class="container">
    <div class="img-container">
        <img style="width: 100%; height: 100px;"  src="{{trail.imgae.url}}" alt="{{trail.name}}">
    </div>
    <div class="trail-details">
        <h1>{{trail.name}}</h1>
        <h4>{{trail.start_date}} - {{trail.end_date}}</h4>
        <p>{{trail.location}}</p>
        <p>{{trail.distance}} miles</p>
        <p>{{trail.elevation}}</p>

        <div class="trail-actions">
            <a href="{% url "trail-update" trail.id%}" class="btn warn">Edit</a>
            <a href="{% url "trail-delete" trail.id%}" class="btn danger">Delete</a>
        </div>
    </div>
</section>


    <div id='map' style='width: 100%; height: 300px;'></div>
    <script>
        mapboxgl.accessToken = '{{ mapbox_access_token }}';
        
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/outdoors-v12', // style URL
            {% if trail.lat and trail.long %}
                center: [{{trail.long}}, {{trail.lat}}], // starting position [lng, lat]
            {% else %}
                center: [-98.35, 39.5] //center of us?
            {% endif %}
            zoom: 13, // starting zoom
        });

        const marker = new mapboxgl.Marker()
                .setLngLat([ {{trail.long}}, {{trail.lat}} ])
                .setPopup(new mapboxgl.Popup().setHTML('<p> {{trail.location}} </p>'))
                .addTo(map);

        const nav = new mapboxgl.NavigationControl();
        map.addControl(nav);
    </script>

{% comment %} <section class="todo-container">
    <div class="subsection-title">
        <h2>TODO List</h2>
    </div>
    <div class="add-todo">
        <h3>Add Todo</h3>
        <form action="{% url "add-todo" trail.id %}" method="post" class="subsection-content" autocomplete="off">
            {% csrf_token %}
            {{todo_form.as_p}}
            <button type="submit" class="btn submit">Add</button>
        </form>
    </div>
    <div class="todo-list">
        <ul>
            {% for todo in trail.todo_set.all %}
            <li>
                <form action="" method="post">
                    {% csrf_token %}
                    <input type="checkbox" name='completed' value="True"
                        {%if todo.completed %} checked {% endif %}
                        onchange = "this.form.submit()"
                        >
                        {{todo.todo}}
                    <input type="hidden" name="todo_id" value={{todo.id}}>
                </form>
            </li>
            {% endfor %}
        </ul>
    </div>
</section> {% endcomment %}


<section class="days-container">
    <div class="subsection-title">
        <h2>Itinerary</h2>
        <a href="{% url "meal-plan" trail.id%}"><h2>Meal Plan</h2></a>
        <img src="" alt="">
        <img src="" alt="">
        <img src="" alt="">
    </div>

    {% for day in trail.day_set.all %}
    <div class="day-container">
        <div class="day-title">
            <a href="{% url "day-detail" day.id%}">

                <h2>Day: {{day.day}}</h2>
                {% if day.start_location or day.finish_location %}
                    <h5>{{day.start_location}} âž¤ {{day.finish_location}}</h5>
                {% else %}
                    <h5> Edit Day to Set Location</h5>
                {% endif %}
            </a>
            
            
        </div>
        {% comment %} <div class="day-details">
            <p>Distance: {{day.distance}} Elevation Gain: {{day.elevation}}</p>
            <p>Notes: {{day.notes}}</p>
        </div>
        <a href="{% url "update-day" day.id %}" class="btn warn">Edit</a> {% endcomment %}
    </div>
    {% endfor %}

</section>

<section class="gear">
    <div class="subsection-title">
        <h2>Gear</h2>
        <img src="" alt="">
        <img src="" alt="">
        <img src="" alt="">
    </div>
    <a href="{% url "available-gear-index" trail.id%}">
        <h3>Available Gear</h3>
    </a>
    <a href="{% url "trail-gear-details" trail.id%}">
        <h3>Gear Details</h3>
    </a>
    <div>
        <h2>Packing List</h2>
        <div class="subsection-content">
            {% if trail.gear.count %}

                {% for gear in trail.gear.all %}

                    {% if gear.packed == False %}

                        <form action="" method="post" autocomplete="off">
                            {% csrf_token %}
                            <input type="checkbox" name="packed" value="True"
                                {% if gear.packed%} checked {% endif %}
                                onchange="this.form.submit()"
                            >
                            {{gear.name}}
                            <input type="hidden" name="gear_id" value="{{gear.id}}">
                        </form>
                    {% endif %}
                
                {% endfor %}
            {% else %}
            <p>No Gear assigned </p>
            {% endif %}
        </div>
    </div>

</section>
{% endblock content %}