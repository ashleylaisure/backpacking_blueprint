{% extends "base.html" %} {% load static %}
{% block head %}
<link rel="stylesheet" href="{% static "css/trails/trail-detail.css" %}">

    <script src='https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.css' rel='stylesheet' />
{% endblock head %}

{% block content %}
<section class="container">
    <div class="img-container">
        <img style="width: 100%; height: 100px;"  src="{{trail.imgae.url}}" alt="{{trail.name}}">
    </div>
    <div class="trail-details">
        <h1>{{trail.name}}</h1>
        <h4>{{trail.start_date}} - {{trail.end_date}}</h4>
        <p>{{trail.location}}</p>
        <p>{{trail.distance}} miles</p>
        <p>{{trail.elevation}}</p>

        <div class="trail-actions">
            <a href="{% url "trail-update" trail.id%}" class="btn warn">Edit</a>
            <a href="{% url "trail-delete" trail.id%}" class="btn danger">Delete</a>
        </div>
    </div>
</section>


    <div id='map' style='width: 100%; height: 300px;'></div>
    <script>
        mapboxgl.accessToken = '{{ mapbox_access_token }}';
        
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/outdoors-v12', // style URL
            {% if trail.lat and trail.long %}
                center: [{{trail.long}}, {{trail.lat}}], // starting position [lng, lat]
            {% else %}
                center: [-98.35, 39.5] //center of us?
            {% endif %}
            zoom: 13, // starting zoom
        });

        const marker = new mapboxgl.Marker()
                .setLngLat([ {{trail.long}}, {{trail.lat}} ])
                .setPopup(new mapboxgl.Popup().setHTML('<p> {{trail.location}} </p>'))
                .addTo(map);

        const nav = new mapboxgl.NavigationControl();
        map.addControl(nav);
    </script>


<section class="days-container">
    <div class="subsection-title">
        <h2>Itinerary</h2>
        <a href="{% url "meal-plan" trail.id%}"><h2>Meal Plan</h2></a>
        <img src="" alt="">
        <img src="" alt="">
        <img src="" alt="">
    </div>

    {% for day in trail.day_set.all %}
    <div class="day-container">
        <div class="day-title">
            <h2>Day: {{day.day}} Date: {{day.date}}</h2>
            <p>{{day.start_location}} To {{day.finish_location}}</p>
        </div>
        <div class="day-details">
            <p>Distance: {{day.distance}} Elevation Gain: {{day.elevation}}</p>
            <p>Notes: {{day.notes}}</p>
        </div>
        <a href="{% url "update-day" day.id %}" class="btn warn">Edit</a>
    </div>
    {% endfor %}

</section>

<section class="gear">
    <div class="subsection-title">
        <h2>Gear</h2>
        <img src="" alt="">
        <img src="" alt="">
        <img src="" alt="">
    </div>
    <a href="{% url "available-gear-index" trail.id%}">
        <h3>Available Gear</h3>
    </a>
    <a href="{% url "trail-gear-details" trail.id%}">
        <h3>Gear Details</h3>
    </a>
    <div>
        <h2>Packing List</h2>
        <div class="subsection-content">
            {% if trail.gear.count %}

                {% for gear in trail.gear.all %}

                    {% if gear.packed == False %}

                        <form action="" method="post" autocomplete="off">
                            {% csrf_token %}
                            {{packed}}
                            <label for="packed">{{gear.name}}</label>
                        </form>
                    {% endif %}
                
                {% endfor %}
            {% else %}
            <p>No Gear assigned </p>
            {% endif %}
        </div>
    </div>

</section>
{% endblock content %}